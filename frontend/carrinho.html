<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Carrinho de Presentes</title>
  <link rel="stylesheet" href="css/styles.css">
</head>

<body>

<h2>Seu Carrinho ðŸ’™</h2>

<div id="carrinho-grid"></div>

<button class="btn" onclick="finalizarCompra()">
  Finalizar compra via PIX
</button>

<br><br>
<a href="presentes.html" class="btn">Voltar para lista</a>

<script>
const API_URL = "https://casamento-vp.onrender.com";

async function carregarCarrinho() {
  const carrinho = JSON.parse(localStorage.getItem("carrinho")) || [];
  const grid = document.getElementById("carrinho-grid");
  grid.innerHTML = "";

  if (carrinho.length === 0) {
    grid.innerHTML = "<p>Seu carrinho estÃ¡ vazio ðŸ’”</p>";
    return;
  }

  for (const id of carrinho) {
    const res = await fetch(`${API_URL}/presentes`);
    const presentes = await res.json();
    const p = presentes.find(x => x._id === id);
    if (!p) continue;

    const div = document.createElement("div");
    div.className = "gift-card";
    div.innerHTML = `
      <img src="${p.imagem}">
      <h3>${p.nome}</h3>
      <p>R$ ${p.preco.toFixed(2)}</p>
    `;
    grid.appendChild(div);
  }
}

async function finalizarCompra() {
  const carrinho = JSON.parse(localStorage.getItem("carrinho")) || [];

  if (!carrinho.length) {
    alert("Carrinho vazio");
    return;
  }

  await fetch(`${API_URL}/presentes/finalizar`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ ids: carrinho })
  });

  localStorage.removeItem("carrinho");

  alert("Presentes reservados! Agora faÃ§a o PIX ðŸ’™");
  location.href = "index.html";
}

carregarCarrinho();
</script>

</body>
</html>
